<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Protected Link Generator - Anti-Bypass System</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <h1>üîí Protected Link Generator</h1>
                <p>Create bypass-protected links for your URL shorteners</p>
            </div>

            <div class="info-box">
                <p><strong>How it works:</strong></p>
                <p>1. Enter your final destination URL below</p>
                <p>2. We'll generate a protected link for you</p>
                <p>3. Shorten that protected link on ShrinkMe, Exe.io, etc.</p>
                <p>4. Share the shortened link - bypass attempts will be blocked!</p>
            </div>

            <form id="linkForm">
                <div class="form-group">
                    <label for="destinationUrl">
                        <strong>Destination URL</strong>
                        <span style="color: var(--text-secondary); font-size: 0.9rem;">
                            (Where users should end up after completing the shortener)
                        </span>
                    </label>
                    <input 
                        type="url" 
                        id="destinationUrl" 
                        placeholder="https://example.com/your-file.pdf"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="shortenerService">
                        <strong>Shortener Service</strong>
                        <span style="color: var(--text-secondary); font-size: 0.9rem;">
                            (Which service will you use?)
                        </span>
                    </label>
                    <select id="shortenerService" required>
                        <option value="shrinkme">ShrinkMe</option>
                        <option value="exe">Exe.io</option>
                        <option value="linkvertise">Linkvertise</option>
                        <option value="shorte">Shorte.st</option>
                        <option value="ouo">Ouo.io</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary" id="generateBtn">
                    Generate Protected Link
                </button>
            </form>

            <div id="resultBox" class="result-box">
                <h3>‚úÖ Protected Link Generated!</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;">
                    Copy this link and shorten it on your chosen service:
                </p>
                
                <div class="copy-box">
                    <input type="text" id="protectedLink" readonly>
                    <button onclick="copyToClipboard()">Copy</button>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: var(--dark-bg); border-radius: 8px;">
                    <p style="font-size: 0.9rem; color: var(--text-secondary);">
                        <strong>Link ID:</strong> <code id="linkId" style="color: var(--primary-color);"></code>
                    </p>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 5px;">
                        <strong>Status:</strong> <span style="color: var(--success-color);">Active & Protected</span>
                    </p>
                </div>

                <div class="alert alert-warning" style="margin-top: 15px;">
                    <strong>‚ö†Ô∏è Important:</strong> This link is protected with multiple security layers. 
                    Users must come through the shortener service to access the final destination.
                </div>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: var(--dark-bg); border-radius: 8px;">
                <h3 style="margin-bottom: 15px; color: var(--text-secondary); font-size: 1rem;">
                    üìä Your Protected Links
                </h3>
                <div id="linksList" style="font-size: 0.9rem; color: var(--text-secondary);">
                    <p>No links created yet. Generate your first protected link above!</p>
                </div>
            </div>
        </div>
    </div>

    <script src="js/link-generator.js"></script>
    <script>
        const generator = new LinkGenerator();
        const form = document.getElementById('linkForm');
        const resultBox = document.getElementById('resultBox');
        const generateBtn = document.getElementById('generateBtn');

        // Initialize
        displayLinksList();

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const destinationUrl = document.getElementById('destinationUrl').value.trim();
            const shortenerService = document.getElementById('shortenerService').value;

            // Disable button during generation
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';

            try {
                // Simulate processing time (for better UX)
                await new Promise(resolve => setTimeout(resolve, 500));

                // Generate protected link
                const result = generator.createProtectedLink(destinationUrl, shortenerService);

                // Display result
                document.getElementById('protectedLink').value = result.protectedLink;
                document.getElementById('linkId').textContent = result.linkId;
                resultBox.classList.add('show');

                // Scroll to result
                resultBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

                // Update links list
                displayLinksList();

                // Reset form
                form.reset();
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate Protected Link';
            }
        });

        function copyToClipboard() {
            const linkInput = document.getElementById('protectedLink');
            linkInput.select();
            linkInput.setSelectionRange(0, 99999); // For mobile devices

            try {
                document.execCommand('copy');
                
                // Visual feedback
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úì Copied!';
                btn.style.background = 'var(--success-color)';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            } catch (err) {
                alert('Failed to copy. Please copy manually.');
            }
        }

        function displayLinksList() {
            const links = generator.getAllLinks();
            const linksList = document.getElementById('linksList');
            
            const entries = Object.entries(links);
            
            if (entries.length === 0) {
                linksList.innerHTML = '<p>No links created yet. Generate your first protected link above!</p>';
                return;
            }

            // Sort by creation time (newest first)
            entries.sort((a, b) => b[1].created - a[1].created);

            let html = '<div style="max-height: 300px; overflow-y: auto;">';
            
            entries.forEach(([linkId, data]) => {
                const shortId = linkId.substring(0, 12) + '...';
                const date = new Date(data.created).toLocaleString();
                const isExpired = generator.isLinkExpired(linkId);
                
                html += `
                    <div style="padding: 12px; margin-bottom: 10px; background: var(--card-bg); border-radius: 6px; border-left: 3px solid ${isExpired ? 'var(--danger-color)' : 'var(--success-color)'};">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="color: var(--text-primary);">${shortId}</strong>
                                <p style="font-size: 0.85rem; margin-top: 4px; color: var(--text-secondary);">
                                    Created: ${date} | Clicks: ${data.clicks || 0} | Service: ${data.shortener}
                                </p>
                            </div>
                            <span style="padding: 4px 8px; background: ${isExpired ? 'rgba(239, 68, 68, 0.2)' : 'rgba(16, 185, 129, 0.2)'}; color: ${isExpired ? 'var(--danger-color)' : 'var(--success-color)'}; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                                ${isExpired ? 'EXPIRED' : 'ACTIVE'}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            linksList.innerHTML = html;
        }

        // Update links list every 10 seconds
        setInterval(displayLinksList, 10000);
    </script>
</body>
</html>
